<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DotLog - 보석십자수 스마트 관리</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d15399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>

<body>
    <div class="main-wrapper">
        <header class="header-section">
            <div>
                <h1 class="logo-text">DotLog</h1>
                <p class="tagline" id="header-tagline">오늘의 작품을 이어가세요.</p>
            </div>
            <div style="text-align: right;">
                <span style="font-size: 0.9rem; font-weight: 700;">Guest User</span><br>
                <span style="font-size: 0.75rem; color: var(--primary); font-weight: 700;">Premium</span>
            </div>
        </header>

        <section class="search-section">
            <div class="search-container">
                <input type="text" id="global-search" placeholder="DMC 비즈 번호를 입력하세요">
                <button class="btn-search">조회</button>
                <div id="search-result-popup" class="search-popup hidden"></div>
            </div>
        </section>

        <!-- Dynamic Pages -->
        <main id="page-content">
            <section id="page-dashboard" class="page active">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 class="section-title" style="margin:0;">진행 중인 도안</h2>
                    <button class="btn-primary" id="btn-new-project"
                        style="border-radius: 30px; width: auto; height: auto; padding: 12px 24px; font-size: 0.95rem;">
                        <i class="fas fa-plus"></i> 도안 등록
                    </button>
                </div>
                <div id="active-projects-container">
                    <!-- Project cards render here -->
                </div>
            </section>

            <section id="page-inventory" class="page">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 class="section-title" style="margin:0;">비즈 창고</h2>
                    <button class="btn-primary" id="btn-add-bead"
                        style="border-radius: 30px; width: auto; height: auto; padding: 12px 24px; font-size: 0.95rem;">
                        <i class="fas fa-plus"></i> 비즈 추가
                    </button>
                </div>

                <div
                    style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px; background: white; padding: 15px; border-radius: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
                    <label
                        style="font-size: 0.9rem; font-weight: 700; color: var(--text-support); white-space: nowrap;">📌
                        도안별 보기:</label>
                    <select id="inventory-project-filter"
                        style="flex: 1; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-light); font-family: inherit;">
                        <option value="all">전체 목록</option>
                        <!-- Project options rendered here -->
                    </select>
                </div>

                <div id="inventory-batch-actions" style="margin-bottom: 20px; display: none;">
                    <!-- Dynamically filled when a project is selected -->
                </div>

                <div class="card" style="padding: 0; overflow: hidden;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>수량</th>
                                <th>위치</th>
                                <th style="text-align: right; padding-right: 25px;">관리</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <!-- Rows render here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="page-scanner" class="page">
                <h2 class="section-title">AI 스마트 도감 도우미</h2>
                <div class="scanner-grid">
                    <div class="scanner-left">
                        <div class="card" style="padding: 2rem;">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <div
                                    style="width: 80px; height: 80px; background: linear-gradient(45deg, #4285f4, #8257e5); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2.5rem; box-shadow: 0 10px 30px rgba(66, 133, 244, 0.3);">
                                    <i class="fas fa-magic"></i>
                                </div>
                                <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">Gemini로 정밀하게 인식하기</h3>
                                <p style="color: var(--text-support); line-height: 1.6;">
                                    복잡한 도안 정보도 구글 AI Gemini를 사용하면<br>
                                    오차 없이 정확하게 추출할 수 있습니다.
                                </p>
                            </div>

                            <div
                                style="background: var(--bg-light); padding: 1.5rem; border-radius: 20px; border-left: 5px solid var(--primary); margin-bottom: 2rem;">
                                <h4 style="margin-bottom: 10px; font-size: 1rem;"><i class="fas fa-info-circle"></i> 사용
                                    가이드</h4>
                                <ol
                                    style="padding-left: 1.25rem; font-size: 0.9rem; color: var(--text-main); line-height: 1.8;">
                                    <li>아래 <b>'Gemini 바로가기'</b> 버튼을 눌러 이동합니다.</li>
                                    <li>도안 리스트 사진을 업로드합니다.</li>
                                    <li>프롬프트창에 <b>아래 문구</b>를 복사해 입력합니다.
                                        <div
                                            style="margin: 10px 0; background: #fff; padding: 10px; border-radius: 10px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                                            <code id="prompt-text"
                                                style="font-weight: 700; color: var(--primary);">순번이랑 코드만 표로 추출해줘</code>
                                            <button onclick="OCR.copyPrompt()" class="btn-secondary"
                                                style="padding: 4px 8px; font-size: 0.7rem;">복사</button>
                                        </div>
                                    </li>
                                    <li>Gemini가 알려준 결과 숫자를 복사해 아래에 붙여넣으세요.</li>
                                </ol>
                            </div>

                            <a href="https://gemini.google.com/" target="_blank" class="btn-primary"
                                style="display: block; text-decoration: none; text-align: center; margin-bottom: 2rem;">
                                <i class="fab fa-google"></i> Gemini 바로가기
                            </a>

                            <div style="margin-top: 2rem;">
                                <label
                                    style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">인식
                                    결과 붙여넣기</label>
                                <textarea id="ai-text-input"
                                    placeholder="Gemini에서 복사한 숫자를 여기에 붙여넣으세요 (예: 153, 156, Z3341...)"
                                    style="width: 100%; height: 120px; border: 1px solid var(--border); border-radius: 16px; padding: 1rem; font-family: inherit; font-size: 1rem; background: var(--bg-light); resize: none;"></textarea>
                                <button class="btn-primary" id="btn-process-text" style="margin-top: 15px;">비즈 리스트
                                    분석하기</button>
                            </div>
                        </div>
                    </div>

                    <div class="scanner-right">
                        <div class="card" style="min-height: 300px;">
                            <h3 style="margin-bottom: 20px;">분석된 비즈 목록</h3>
                            <div id="scan-results-container">
                                <p style="color: var(--text-support); text-align: center; margin-top: 50px;">Gemini에서 받은
                                    번호를 분석하면<br>여기에 결과가 표시됩니다.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="page-collection" class="page">
                <h2 class="section-title">완성 도감</h2>
                <div id="collection-container"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                    <!-- Gallery render here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-page="dashboard">
            <i class="fas fa-home"></i>
            <span>홈</span>
        </div>
        <div class="nav-item" data-page="scanner">
            <i class="fas fa-expand"></i>
            <span>스캔</span>
        </div>
        <div class="nav-item" data-page="inventory">
            <i class="fas fa-box"></i>
            <span>비즈창고</span>
        </div>
        <div class="nav-item" data-page="collection">
            <i class="fas fa-palette"></i>
            <span>완성도안</span>
        </div>
    </nav>

    <!-- Modal Project Add -->
    <div id="modal-project" class="modal"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px;">
        <div class="modal-content" style="max-width: 500px; width: 100%;">
            <h2 style="margin-bottom: 2rem; font-weight: 800;">새 도안 등록</h2>
            <form id="form-project">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">도안
                        이름</label>
                    <input type="text" name="name" required placeholder="예: 고흐의 별밤"
                        style="width: 100%; padding: 1.25rem; border: 1px solid var(--border); border-radius: 16px; background: var(--bg-light);">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label
                        style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">브랜드</label>
                    <input type="text" name="brand" placeholder="예: DAC"
                        style="width: 100%; padding: 1.25rem; border: 1px solid var(--border); border-radius: 16px; background: var(--bg-light);">
                </div>
                <div style="margin-bottom: 2.5rem;">
                    <label style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">도안
                        완성 이미지 (선택)</label>
                    <div id="project-img-preview"
                        style="width: 100%; height: 180px; background: var(--bg-light); border: 2px dashed var(--border); border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 10px; cursor: pointer;">
                        <i class="fas fa-image" style="font-size: 2rem; color: var(--text-support);"></i>
                    </div>
                    <input type="file" id="input-project-image" accept="image/*" style="display: none;">
                    <input type="hidden" name="image" id="project-image-base64">
                </div>
                <button type="submit" class="btn-primary">시작하기</button>
                <div id="btn-close-modal"
                    style="text-align: center; margin-top: 20px; color: var(--text-support); cursor: pointer; font-weight: 600;">
                    다음에 하기</div>
            </form>
        </div>
    </div>

    <!-- Modal Bead Add -->
    <div id="modal-bead" class="modal"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px;">
        <div class="modal-content" style="max-width: 450px; width: 100%;">
            <h2 style="margin-bottom: 2rem; font-weight: 800;">비즈 직접 추가</h2>
            <form id="form-bead">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">비즈
                        번호 (DMC)</label>
                    <input type="text" name="dmc" required placeholder="예: 310, 814"
                        style="width: 100%; padding: 1.25rem; border: 1px solid var(--border); border-radius: 16px; background: var(--bg-light);">
                </div>
                <div style="display: flex; gap: 15px; margin-bottom: 1.5rem;">
                    <div style="flex: 1;">
                        <label
                            style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">수량</label>
                        <input type="number" name="count" value="1" min="1" required
                            style="width: 100%; padding: 1.25rem; border: 1px solid var(--border); border-radius: 16px; background: var(--bg-light);">
                    </div>
                    <div style="flex: 1;">
                        <label
                            style="display: block; font-weight: 700; margin-bottom: 10px; color: var(--text-support);">위치</label>
                        <input type="text" name="location" placeholder="예: A-1"
                            style="width: 100%; padding: 1.25rem; border: 1px solid var(--border); border-radius: 16px; background: var(--bg-light);">
                    </div>
                </div>
                <button type="submit" class="btn-primary">추가하기</button>
                <div id="btn-close-bead-modal"
                    style="text-align: center; margin-top: 20px; color: var(--text-support); cursor: pointer; font-weight: 600;">
                    닫기</div>
            </form>
        </div>
    </div>

    <!-- Modal Project Detail -->
    <div id="modal-project-detail" class="modal"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px;">
        <div class="modal-content" style="max-width: 600px; width: 100%; max-height: 85vh; overflow-y: auto;">
            <div id="project-detail-content">
                <!-- Detail content and buttons rendered here dynamically -->
            </div>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/ocr.js"></script>
    <script src="js/app.js"></script>
</body>

</html>